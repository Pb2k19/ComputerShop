@page "/cart"
@inject ICartService CartService
@implements IDisposable

<style>
    .cart-img{
        overflow: hidden;
        max-width: 250px;
    }
    .item-row{
        min-height: 225px;
    }
    #cart-containter {
        font-size: 1.5rem;
    }
    .product-name:hover{
        opacity: 1.1;
    }
</style>

<div id ="cart-containter" class="container-fluid">
    <div class="row mx-1 mx-xl-3">
        <div class="col-xl-7">
            @if (productCartItems != null && productCartItems.Count > 0)
            {
                <h1>Twój koszyk</h1>
                @foreach (var p in productCartItems.OrderBy(x=> $"{x.Product.Manufacturer} {x.Product.Name}"))
                {
                    <div>
                        <div class="position-relative">
                            <button @onclick="()=>OnItemRemoveAsync(p.Product.Id)" class="position-absolute btn-close top-0 end-0 mt-2 shadow-none"></button>
                        </div>
                        <div class="row row-cols-2 row-cols-lg-4 item-row align-items-center rounded shadow mt-4 pt-4 pt-sm-0">
                            <div @onclick="()=>GoToProductPage(p.Product.Id)" class="col-5 py-4 cart-img cursorHand">
                                <img src="@p.Product.Images?.FirstOrDefault()?.Location" class="card-img-top cursorHand">
                            </div>
                            <div @onclick="()=>GoToProductPage(p.Product.Id)" class="col-7 col-lg-4 py-4 text-center product-name cursorHand">
                                <span>@p.Product.Manufacturer @p.Product.Name</span>
                            </div>
                            <div class="col-6 col-lg-2 py-4 text-end text-lg-center">
                                @if (p.Product.Price < p.Product.PriceBeforeDiscount)
                                {
                                    <div class="d-flex justify-content-center align-items-center">
                                        <span class="text-muted text-decoration-line-through">@p.Product.PriceBeforeDiscount</span>
                                        <span style="color: #0b5ed7;">&ensp;-@(decimal.ToInt32((p.Product.PriceBeforeDiscount - p.Product.Price) / p.Product.PriceBeforeDiscount * 100))%</span>
                                    </div>
                                }
                                <span class="text-end">@p.Product.Price zł</span>
                            </div>
                            <div class="col-6 col-lg-3 d-lg-flex justify-content-lg-center">
                                <div class=" " style="max-width: 125px;">
                                    <NumericUpDown InitValue="p.Quantity" MaxValue="99" MinValue="1" OnValueChanged="@((args)=>OnValueChangedAsync(args,p.Product.Id))" />
                                </div>
                            </div>
                        </div>
                    </div>
                }
            }
            else
            {
                <span>Twój koszyk jest pusty</span>
            }
        </div>
        <div class="col-xl-5">
            <span>Do zapłaty</span>
            <span>Wybierz opcję dostawy</span>
        </div>
    </div>
</div>

